import fs from 'fs'
import path from 'path'
import { defineConfig } from 'vitepress'
import { withMermaid } from 'vitepress-plugin-mermaid'

export default withMermaid(
  defineConfig({
    base: '/{{ name }}/',
    title: '{{ name }}',
    description: '{{ description }}',
    ignoreDeadLinks: true,
    head: [
      ['link', { href: 'https://cdnjs.cloudflare.com/ajax/libs/line-awesome/1.3.0/line-awesome/css/line-awesome.min.css', rel: 'stylesheet' }],
      ['link', { rel: 'icon', href: 'https://kalisio.github.io/kalisioscope/kalisio/kalisio-icon-2048x2048.png' }]
    ],
    themeConfig: {
      logo: 'https://kalisio.github.io/kalisioscope/kalisio/kalisio-icon-2048x2048.png',
      socialLinks: [{ icon: 'github', link: 'https://github.com/kalisio/{{ name }}' }],
      nav: [
        { text: 'Overview', link: '/overview/about' }
        {{#if internalPackages.length}},
        {
          text: 'Packages',
          items: [
            {{#each internalPackages}}
            { text: '{{ this }}', link: '/packages/{{ this }}/' }{{#unless @last}},{{/unless}}
            {{/each}}
          ]
        }
        {{/if}}
      ],
      sidebar: {
        '/overview/': [
          { text: 'About', link: '/overview/about' },
          { text: 'Contributing', link: '/overview/contributing' },
          { text: 'License', link: '/overview/license' },
          { text: 'Contact', link: '/overview/contact' }
        ]
        {{#if internalPackages.length}},
        {{#each internalPackages}}
        '/{{ this }}/': getSideBar('{{ this }}'){{#unless @last}},{{/unless}}
        {{/each}}
        {{/if}}
      },
      footer: {
        copyright: 'MIT Licensed | Copyright Â© 2026 Kalisio'
      }
    },
    vite: {
      optimizeDeps: {
        include: ['keycloak-js', 'lodash', 'dayjs', 'mermaid', 'cytoscape', 'cytoscape-cose-bilkent'],
      },
      ssr: {
        noExternal: ['vitepress-theme-kalisio', 'dayjs', 'mermaid', 'cytoscape', 'cytoscape-cose-bilkent']
      }
    }
  })
)


function getSideBar (pkg) {
  // TODO
}